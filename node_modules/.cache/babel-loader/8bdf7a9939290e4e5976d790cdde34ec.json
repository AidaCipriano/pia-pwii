{"ast":null,"code":"import * as SockJS from 'sockjs-client';\nimport { Stomp } from '@stomp/stompjs';\nexport let socket = null;\nexport var stompClient = null;\nvar username = null;\nvar onMessageFun = null;\nexport const initiateSocket = (email, lamb) => {\n  disconnectSocket();\n\n  if (socket === null && stompClient === null) {\n    //socket = new SockJS('http://localhost:4000/websocket');\n    stompClient = Stomp.over(() => {\n      socket = new SockJS('http://localhost:4000/websocket');\n      return socket;\n    });\n    onMessageFun = lamb;\n    username = email;\n    stompClient.connect({}, onConnected, onError);\n    console.log(`Connecting socket...`);\n  } //  if (socket && room) socket.emit('join', room);\n\n};\nexport const disconnectSocket = () => {\n  if (socket !== null) {\n    console.log('Disconnecting socket...');\n    socket.close();\n    socket = null;\n    stompClient = null;\n  } //  if(socket) socket.disconnect();\n\n};\nexport const subscribeToChat = cb => {\n  if (!socket) return true; //  socket.on('chat', msg => {\n\n  console.log('Websocket event received!'); //    return cb(null, msg); });\n};\nexport const sendMessage = (room, message) => {//  if (socket) socket.emit('chat', { message, room });\n};\n\nfunction onConnected() {\n  // Subscribe to the Public Topic\n  stompClient.subscribe('/topic/public', payload => onMessageFun.addMessage(payload)); //onMessageReceived\n  // Tell your username to the server\n\n  stompClient.send(\"/app/chat.register\", {}, JSON.stringify({\n    sender: username,\n    type: 'JOIN'\n  }));\n  onMessageFun.handleLogin(\"connected\");\n}\n\nfunction onError(error) {\n  console.dir(error);\n}\n\nfunction onMessageReceived(payload) {\n  var message = JSON.parse(payload.body);\n  var messageElement = document.createElement('li');\n\n  if (message.type === 'JOIN') {\n    messageElement.classList.add('event-message');\n    message.content = message.sender + ' joined!';\n  } else if (message.type === 'LEAVE') {\n    messageElement.classList.add('event-message');\n    message.content = message.sender + ' left!';\n  } else {\n    messageElement.classList.add('chat-message');\n    var avatarElement = document.createElement('i');\n    var avatarText = document.createTextNode(message.sender[0]);\n    avatarElement.appendChild(avatarText);\n    avatarElement.style['background-color'] = getAvatarColor(message.sender);\n    messageElement.appendChild(avatarElement);\n    var usernameElement = document.createElement('span');\n    var usernameText = document.createTextNode(message.sender);\n    usernameElement.appendChild(usernameText);\n    messageElement.appendChild(usernameElement);\n  }\n\n  var textElement = document.createElement('p');\n  var messageText = document.createTextNode(message.content);\n  textElement.appendChild(messageText);\n  messageElement.appendChild(textElement); //messageArea.appendChild(messageElement);\n  //messageArea.scrollTop = messageArea.scrollHeight;\n}\n\nfunction getAvatarColor(messageSender) {\n  var hash = 0;\n\n  for (var i = 0; i < messageSender.length; i++) {\n    hash = 31 * hash + messageSender.charCodeAt(i);\n  }\n\n  var index = 1; //Math.abs(hash % colors.length);\n\n  return index; //colors[index];\n}","map":{"version":3,"names":["SockJS","Stomp","socket","stompClient","username","onMessageFun","initiateSocket","email","lamb","disconnectSocket","over","connect","onConnected","onError","console","log","close","subscribeToChat","cb","sendMessage","room","message","subscribe","payload","addMessage","send","JSON","stringify","sender","type","handleLogin","error","dir","onMessageReceived","parse","body","messageElement","document","createElement","classList","add","content","avatarElement","avatarText","createTextNode","appendChild","style","getAvatarColor","usernameElement","usernameText","textElement","messageText","messageSender","hash","i","length","charCodeAt","index"],"sources":["A:/Users/cesar/Downloads/POI_Oscar/POI-PROYECTOFINAL/POI-PROYECTOFINAL/src/SocketService.js"],"sourcesContent":["import * as SockJS from 'sockjs-client';\nimport { Stomp } from '@stomp/stompjs'\n\nexport let socket = null;\nexport var stompClient = null;\nvar username = null;\nvar onMessageFun = null;\nexport const initiateSocket = (email, lamb) => {\n    disconnectSocket();\n    if (socket === null && stompClient === null){\n        //socket = new SockJS('http://localhost:4000/websocket');\n        stompClient = Stomp.over(() => {\n            socket = new SockJS('http://localhost:4000/websocket');\n            return socket;\n        });\n        onMessageFun = lamb;\n        username = email\n        stompClient.connect({}, onConnected, onError);\n        console.log(`Connecting socket...`);\n    }\n//  if (socket && room) socket.emit('join', room);\n}\nexport const disconnectSocket = () => {\n    if (socket !== null){\n        console.log('Disconnecting socket...');\n        socket.close();\n        socket = null;\n        stompClient = null;      \n    }\n//  if(socket) socket.disconnect();\n}\nexport const subscribeToChat = (cb) => {\n  if (!socket) return(true);\n//  socket.on('chat', msg => {\n    console.log('Websocket event received!');\n//    return cb(null, msg); });\n}\nexport const sendMessage = (room, message) => {\n//  if (socket) socket.emit('chat', { message, room });\n}\n\nfunction onConnected() {\n    // Subscribe to the Public Topic\n    stompClient.subscribe('/topic/public', (payload) => onMessageFun.addMessage(payload)); //onMessageReceived\n\n    // Tell your username to the server\n    stompClient.send(\"/app/chat.register\",\n        {},\n        JSON.stringify({sender: username, type: 'JOIN'})\n    )\n    onMessageFun.handleLogin(\"connected\");\n\n}\n\n\nfunction onError(error) {\n    console.dir(error);\n}\n\nfunction onMessageReceived(payload) {\n    var message = JSON.parse(payload.body);\n\n    var messageElement = document.createElement('li');\n\n    if(message.type === 'JOIN') {\n        messageElement.classList.add('event-message');\n        message.content = message.sender + ' joined!';\n    } else if (message.type === 'LEAVE') {\n        messageElement.classList.add('event-message');\n        message.content = message.sender + ' left!';\n    } else {\n        messageElement.classList.add('chat-message');\n\n        var avatarElement = document.createElement('i');\n        var avatarText = document.createTextNode(message.sender[0]);\n        avatarElement.appendChild(avatarText);\n        avatarElement.style['background-color'] = getAvatarColor(message.sender);\n\n        messageElement.appendChild(avatarElement);\n\n        var usernameElement = document.createElement('span');\n        var usernameText = document.createTextNode(message.sender);\n        usernameElement.appendChild(usernameText);\n        messageElement.appendChild(usernameElement);\n    }\n\n    var textElement = document.createElement('p');\n    var messageText = document.createTextNode(message.content);\n    textElement.appendChild(messageText);\n\n    messageElement.appendChild(textElement);\n\n    //messageArea.appendChild(messageElement);\n    //messageArea.scrollTop = messageArea.scrollHeight;\n}\n\n\nfunction getAvatarColor(messageSender) {\n    var hash = 0;\n    for (var i = 0; i < messageSender.length; i++) {\n        hash = 31 * hash + messageSender.charCodeAt(i);\n    }\n\n    var index = 1;//Math.abs(hash % colors.length);\n    return index;//colors[index];\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}