{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\User\\\\Downloads\\\\POI_Tims\\\\POI-PROYECTOFINAL\\\\POI-PROYECTOFINAL\\\\src\\\\Components\\\\ChatWindow.jsx\",\n    _s = $RefreshSig$();\n\n//import Navigation from '../Components/NavigationLayout';\n//import Badge from 'react-bootstrap/Badge';\n//import ListGroup from 'react-bootstrap/ListGroup';\n//import Card from 'react-bootstrap/Card';\n//import Stack from 'react-bootstrap/Stack';\n//import Button from 'react-bootstrap/Button';\n//import Form from 'react-bootstrap/Form';\n//import { Container } from 'react-bootstrap';\n//import { collection, query, where, getDocs, serverTimestamp, onSnapshot, doc, updateDoc, Timestamp } from \"firebase/firestore\";\n//import Search from '../Components/Search';\n//import { db, storage } from '../firebase';\n//import { arrayUnion, arrayRemove, getDoc } from \"firebase/firestore\";\n//import { getDownloadURL, ref, uploadBytesResumable } from \"firebase/storage\";\n//\n//\n////Bootstrap\n//import InputGroup from 'react-bootstrap/InputGroup';\n//import { useContext } from 'react';\n//import { ChatConext } from '../Context/ChatContext';\n//import { useState } from 'react';\n//import { useEffect } from 'react';\n//import { v4 as uuid } from \"uuid\";\n//import { AuthConext } from '../Context/AuthContext';\n//import Mensaje from './Mensaje';\n//import MessageGroup from './MessageGroup';\n//import CryptoJS from 'crypto-js';\n//\n//const ChatWindow = () => {\n//\n//     //Manejar estado de encriptacion\n//     const [encriptar, setEncriptar] = useState(false);\n//\n//     const toggleEncrypt = () => {\n//         setEncriptar(!encriptar)\n//         console.log(encriptar)\n//     }\n// \n//     //Funciones para encriptar los mensajes\n//     const cifrar = (texto) => {\n//         console.log(\"AQUIIII\")\n//         if (encriptar) {\n//             var textoCifrado = CryptoJS.AES.encrypt(texto, \"poi\").toString();\n//             console.log(\"se encripto\")\n//             return textoCifrado;\n//         } else {\n//             console.log(\"No se encripto\")\n//             return texto;\n//         }\n//     }\n// \n//    \n//\n//    const { data } = useContext(ChatConext);\n//    const [err, setErr] = useState(false);\n//    //const [cifrado, setCifrado] = useState(false);\n//\n//    const [idGroup, setIdGroup] = useState(\"null\");\n//    const [messages, setMessages] = useState([]);\n//    const [messagesGroup, setMessagesGroup] = useState([]);\n//\n//    const [chatIsGroup, setIsGroup] = useState(false);\n//\n//    const { currentUser } = useContext(AuthConext);\n//\n//    useEffect(() => {\n//        const unSub = onSnapshot(doc(db, \"chats\", data.chatId), (doc) => {\n//            doc.exists() && setMessages(doc.data().messages)\n//        })\n//\n//\n//\n//\n//\n//        return () => {\n//\n//            unSub()\n//        }\n//\n//\n//\n//    }, [data.chatId]);\n//\n//    useEffect(() => {\n//\n//        const unSubGroup = onSnapshot(doc(db, \"chats\", idGroup), (doc) => {\n//            doc.exists() && setMessagesGroup(doc.data().messages)\n//            console.log(idGroup)\n//        })\n//\n//        return () => {\n//            unSubGroup()\n//        }\n//\n//\n//\n//    }, [idGroup]);\n//    \n//\n//\n//\n//    //DIVISION PARA EL ENVIO DE MENSAJES\n//    const [text, setText] = useState(\"\");\n//    const [img, setImg] = useState(null);\n//\n//    const handleSendMessageLocation = async () => {\n//        navigator.geolocation.getCurrentPosition(showPosition, showError);\n//        \n//        function getLocation(){\n//            if (navigator.geolocation){\n//               navigator.geolocation.getCurrentPosition(showPosition);\n//              }else{\n//                 alert(\"Geolocation is not supported by this browser.\");\n//              }\n//            }\n//           getLocation()\n//          function showPosition(position) {\n//                //var str=\"Longitude: \"+ position.coords.longitude+\"Latitude:\"+ position.coords.latitude\n//                //var str=\"Longitude: \"+ position.coords.longitude+\"Latitude:\"+ position.coords.latitude\n//                var str=\"https://www.google.com/maps/place/\" + position.coords.longitude + \",\" +- position.coords.latitude\n//\n//\n//                document.getElementById(\"mensaje\").value=str\n//            }\n//            function showError( error ) {\n//                console.log( 'getCurrentPosition returned error', error);\n//            }\n//    }\n//\n//    const handleSendMessage = async () => {\n//\n//        if (chatIsGroup) {\n//            console.log(\"es grupo\")\n//            if (img) {\n//                const storageRef = ref(storage, uuid());\n//\n//                const uploadTask = uploadBytesResumable(storageRef, img);\n//\n//                uploadTask.on(\n//                    (error) => {\n//                        //TODO:Handle Error\n//                    },\n//                    () => {\n//                        getDownloadURL(uploadTask.snapshot.ref).then(async (downloadURL) => {\n//                            await updateDoc(doc(db, \"chats\", idGroup), {\n//                                messages: arrayUnion({\n//                                    id: uuid(),\n//                                    text: cifrar(text),\n//                                    senderId: currentUser.uid,\n//                                    date: Timestamp.now(),\n//                                    img: downloadURL,\n//                                    displayName: currentUser.displayName,\n//                                    photoURL: currentUser.photoURL,\n//                                }),\n//                            });\n//                        });\n//                    }\n//                );\n//\n//            } else {\n//                await updateDoc(doc(db, \"chats\", idGroup), {\n//                    messages: arrayUnion({\n//                        id: uuid(),\n//                        text: cifrar(text),\n//                        senderId: currentUser.uid,\n//                        date: Timestamp.now(),\n//                        displayName: currentUser.displayName,\n//                        photoURL: currentUser.photoURL,\n//                    })\n//                })\n//            }\n//        } else {\n//            if (img) {\n//                const storageRef = ref(storage, uuid());\n//\n//                const uploadTask = uploadBytesResumable(storageRef, img);\n//\n//                uploadTask.on(\n//                    (error) => {\n//                        //TODO:Handle Error\n//                    },\n//                    () => {\n//                        getDownloadURL(uploadTask.snapshot.ref).then(async (downloadURL) => {\n//                            await updateDoc(doc(db, \"chats\", data.chatId), {\n//                                messages: arrayUnion({\n//                                    id: uuid(),\n//                                    text: cifrar(text),\n//                                    senderId: currentUser.uid,\n//                                    date: Timestamp.now(),\n//                                    img: downloadURL,\n//                                }),\n//                            });\n//                        });\n//                    }\n//                );\n//\n//            } else {\n//                await updateDoc(doc(db, \"chats\", data.chatId), {\n//                    messages: arrayUnion({\n//                        id: uuid(),\n//                        text: cifrar(text),\n//                        senderId: currentUser.uid,\n//                        date: Timestamp.now(),\n//                    })\n//                })\n//            }\n//\n//            await updateDoc(doc(db, \"userChats\", currentUser.uid), {\n//                [data.chatId + \".lastMessage\"]: {\n//                    text,\n//                },\n//                [data.chatId + \".date\"]: serverTimestamp(),\n//            });\n//\n//            await updateDoc(doc(db, \"userChats\", data.user.uid), {\n//                [data.chatId + \".lastMessage\"]: {\n//                    text,\n//                },\n//                [data.chatId + \".date\"]: serverTimestamp(),\n//            });\n//        }\n//\n//\n//        setIsGroup(false);\n//        setIdGroup(\"null\")\n//        setMessagesGroup([])\n//        console.log(\"ya lo puse falso\")\n//        setText(\"\");\n//        setImg(null);\n//    }\n//\n//\n//    // DIVISION PARA TRAER MSG DE UN GRUPO\n//    const handlerGroup = async (g) => {\n//\n//        try {\n//            console.log(\"chats/\" + g)\n//            const docRef = doc(db, \"chats\", g);\n//            const docSnap = await getDoc(docRef);\n//\n//            if (docSnap.exists()) {\n//                console.log(\"Document data:\", docSnap.data());\n//                setIsGroup(true);\n//                setIdGroup(g);\n//            } else {\n//                // doc.data() will be undefined in this case\n//                console.log(\"No such document!\");\n//                setIsGroup(false);\n//                setIdGroup(\"null\");\n//                setMessagesGroup([])\n//            }\n//\n//        } catch (err) {\n//\n//        }\n//    }\n//\n//    const handlerDefaultUser = () => {\n//\n//        console.log(\"yo\")\n//\n//    }\n//\n//\n//\n//    return (\n//        <div className='w-75 ms-5 h-100' >\n//            <Card className='chatContainer w-100 h-100' style={{}}>\n//                <Card.Body className='.bg-info'>\n//                    <Card.Title onClick={handlerDefaultUser} onChange={handlerGroup(data.user?.displayName)}>{data.user?.displayName}</Card.Title>\n//                </Card.Body>\n//                <ListGroup className=\"list-group-flush overflow-auto\">\n//\n//\n//                    {messages.map((m) => (\n//                        <Mensaje message={m} key={m.id} />\n//                    ))}\n//\n//                    {messagesGroup.map((m) => (\n//                        <MessageGroup message={m} key={m.id} />\n//                    ))}\n//\n//\n//\n//                </ListGroup>\n//                <Card.Body>\n//                    <Stack direction=\"horizontal\" gap={3}>\n//                        <Form.Control id=\"mensaje\" className=\"me-auto\" placeholder=\"Mensaje a enviar...\" onChange={e => setText(e.target.value)} />\n//                        <Form>\n//                        <Form.Check onClick={toggleEncrypt}\n//                            type=\"switch\"\n//                            id=\"custom-switch\"\n//                            label=\"Cifrar mensaje\"\n//                        />\n//                        </Form>\n//                        <div className=\"vr\" />\n//                        <a href=\"http://localhost:4000/08db96f7-b409-40ee-8317-307c925d302d\">Video</a>\n//                        <Form.Control type=\"file\" onChange={e => setImg(e.target.files[0])} />\n//                        <Button variant=\"primary\" onClick={handleSendMessageLocation}>Enviar ubicación</Button>\n//                        <Button variant=\"danger\" onClick={handleSendMessage}>Enviar mensaje</Button>\n//\n//                    </Stack>\n//                </Card.Body>\n//            </Card>\n//        </div>\n//\n//    )\n//\n//}\n//\n//export default ChatWindow\nimport Navigation from '../Components/NavigationLayout';\nimport Badge from 'react-bootstrap/Badge';\nimport ListGroup from 'react-bootstrap/ListGroup';\nimport Card from 'react-bootstrap/Card';\nimport Stack from 'react-bootstrap/Stack';\nimport Button from 'react-bootstrap/Button';\nimport Form from 'react-bootstrap/Form';\nimport { Container } from 'react-bootstrap';\nimport { collection, query, where, getDocs, serverTimestamp, onSnapshot, doc, updateDoc, Timestamp } from \"firebase/firestore\";\nimport Search from '../Components/Search';\nimport { db, storage } from '../firebase';\nimport { arrayUnion, arrayRemove, getDoc } from \"firebase/firestore\";\nimport { getDownloadURL, ref, uploadBytesResumable } from \"firebase/storage\"; //Bootstrap\n\nimport InputGroup from 'react-bootstrap/InputGroup';\nimport { useContext } from 'react';\nimport { ChatConext } from '../Context/ChatContext';\nimport { useState } from 'react';\nimport { useEffect } from 'react';\nimport { v4 as uuid } from \"uuid\";\nimport { AuthConext } from '../Context/AuthContext';\nimport Mensaje from './Mensaje';\nimport MessageGroup from './MessageGroup';\nimport CryptoJS from 'crypto-js';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst ChatWindow = () => {\n  _s();\n\n  var _data$user, _data$user2;\n\n  //Manejar estado de encriptacion\n  const [encriptar, setEncriptar] = useState(false);\n\n  const toggleEncrypt = () => {\n    setEncriptar(!encriptar);\n    console.log(encriptar);\n  }; //Funciones para encriptar los mensajes\n\n\n  const cifrar = texto => {\n    console.log(\"AQUIIII\");\n\n    if (encriptar) {\n      var textoCifrado = CryptoJS.AES.encrypt(texto, \"poi\").toString();\n      console.log(\"se encripto\");\n      return textoCifrado;\n    } else {\n      console.log(\"No se encripto\");\n      return texto;\n    }\n  };\n\n  const {\n    data\n  } = useContext(ChatConext);\n  const [err, setErr] = useState(false); //const [cifrado, setCifrado] = useState(false);\n\n  const [idGroup, setIdGroup] = useState(\"null\");\n  const [messages, setMessages] = useState([]);\n  const [messagesGroup, setMessagesGroup] = useState([]);\n  const [chatIsGroup, setIsGroup] = useState(false);\n  const {\n    currentUser\n  } = useContext(AuthConext);\n  useEffect(() => {\n    const unSub = onSnapshot(doc(db, \"chats\", data.chatId), doc => {\n      doc.exists() && setMessages(doc.data().messages);\n    });\n    return () => {\n      unSub();\n    };\n  }, [data.chatId]);\n  useEffect(() => {\n    const unSubGroup = onSnapshot(doc(db, \"chats\", idGroup), doc => {\n      doc.exists() && setMessagesGroup(doc.data().messages);\n      console.log(idGroup);\n    });\n    return () => {\n      unSubGroup();\n    };\n  }, [idGroup]); //DIVISION PARA EL ENVIO DE MENSAJES\n\n  const [text, setText] = useState(\"\");\n  const [img, setImg] = useState(null);\n\n  const handleSendMessageLocation = async () => {\n    navigator.geolocation.getCurrentPosition(showPosition, showError);\n\n    function getLocation() {\n      if (navigator.geolocation) {\n        navigator.geolocation.getCurrentPosition(showPosition);\n      } else {\n        alert(\"Geolocation is not supported by this browser.\");\n      }\n    }\n\n    getLocation();\n\n    function showPosition(position) {\n      //var str=\"Longitude: \"+ position.coords.longitude+\"Latitude:\"+ position.coords.latitude\n      //var str=\"Longitude: \"+ position.coords.longitude+\"Latitude:\"+ position.coords.latitude\n      var str = \"https://www.google.com/maps/place/\" + position.coords.longitude + \",\" + -position.coords.latitude;\n      document.getElementById(\"mensaje\").value = str;\n    }\n\n    function showError(error) {\n      console.log('getCurrentPosition returned error', error);\n    }\n  };\n\n  const handleSendMessage = async () => {\n    if (chatIsGroup) {\n      console.log(\"es grupo\");\n\n      if (img) {\n        const storageRef = ref(storage, uuid());\n        const uploadTask = uploadBytesResumable(storageRef, img);\n        uploadTask.on(error => {//TODO:Handle Error\n        }, () => {\n          getDownloadURL(uploadTask.snapshot.ref).then(async downloadURL => {\n            await updateDoc(doc(db, \"chats\", idGroup), {\n              messages: arrayUnion({\n                id: uuid(),\n                text: cifrar(text),\n                senderId: currentUser.uid,\n                date: Timestamp.now(),\n                img: downloadURL,\n                displayName: currentUser.displayName,\n                photoURL: currentUser.photoURL\n              })\n            });\n          });\n        });\n      } else {\n        await updateDoc(doc(db, \"chats\", idGroup), {\n          messages: arrayUnion({\n            id: uuid(),\n            text: cifrar(text),\n            senderId: currentUser.uid,\n            date: Timestamp.now(),\n            displayName: currentUser.displayName,\n            photoURL: currentUser.photoURL\n          })\n        });\n      }\n    } else {\n      if (img) {\n        const storageRef = ref(storage, uuid());\n        const uploadTask = uploadBytesResumable(storageRef, img);\n        uploadTask.on(error => {//TODO:Handle Error\n        }, () => {\n          getDownloadURL(uploadTask.snapshot.ref).then(async downloadURL => {\n            await updateDoc(doc(db, \"chats\", data.chatId), {\n              messages: arrayUnion({\n                id: uuid(),\n                text: cifrar(text),\n                senderId: currentUser.uid,\n                date: Timestamp.now(),\n                img: downloadURL\n              })\n            });\n          });\n        });\n      } else {\n        await updateDoc(doc(db, \"chats\", data.chatId), {\n          messages: arrayUnion({\n            id: uuid(),\n            text: cifrar(text),\n            senderId: currentUser.uid,\n            date: Timestamp.now()\n          })\n        });\n      }\n\n      await updateDoc(doc(db, \"userChats\", currentUser.uid), {\n        [data.chatId + \".lastMessage\"]: {\n          text\n        },\n        [data.chatId + \".date\"]: serverTimestamp()\n      });\n      await updateDoc(doc(db, \"userChats\", data.user.uid), {\n        [data.chatId + \".lastMessage\"]: {\n          text\n        },\n        [data.chatId + \".date\"]: serverTimestamp()\n      });\n    }\n\n    setIsGroup(false);\n    setIdGroup(\"null\");\n    setMessagesGroup([]);\n    console.log(\"ya lo puse falso\");\n    setText(\"\");\n    setImg(null);\n  }; // DIVISION PARA TRAER MSG DE UN GRUPO\n\n\n  const handlerGroup = async g => {\n    try {\n      console.log(\"chats/\" + g);\n      const docRef = doc(db, \"chats\", g);\n      const docSnap = await getDoc(docRef);\n\n      if (docSnap.exists()) {\n        console.log(\"Document data:\", docSnap.data());\n        setIsGroup(true);\n        setIdGroup(g);\n      } else {\n        // doc.data() will be undefined in this case\n        //console.log(\"No such document!\");\n        setIsGroup(false);\n        setIdGroup(\"null\");\n        setMessagesGroup([]);\n      }\n    } catch (err) {}\n  };\n\n  const handlerDefaultUser = () => {\n    console.log(\"yo\");\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"w-75 ms-5 h-100\",\n    children: /*#__PURE__*/_jsxDEV(Card, {\n      className: \"chatContainer w-100 h-100\",\n      style: {},\n      children: [/*#__PURE__*/_jsxDEV(Card.Body, {\n        className: \".bg-info\",\n        children: /*#__PURE__*/_jsxDEV(Card.Title, {\n          children: (_data$user = data.user) === null || _data$user === void 0 ? void 0 : _data$user.displayName\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 580,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 579,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(ListGroup, {\n        className: \"list-group-flush overflow-auto\",\n        onClick: handlerDefaultUser,\n        onChange: handlerGroup((_data$user2 = data.user) === null || _data$user2 === void 0 ? void 0 : _data$user2.displayName),\n        children: [messages.map(m => /*#__PURE__*/_jsxDEV(Mensaje, {\n          message: m\n        }, m.id, false, {\n          fileName: _jsxFileName,\n          lineNumber: 586,\n          columnNumber: 25\n        }, this)), messagesGroup.map(m => /*#__PURE__*/_jsxDEV(MessageGroup, {\n          message: m\n        }, m.id, false, {\n          fileName: _jsxFileName,\n          lineNumber: 590,\n          columnNumber: 25\n        }, this))]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 582,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Card.Body, {\n        children: /*#__PURE__*/_jsxDEV(Stack, {\n          direction: \"horizontal\",\n          gap: 3,\n          children: [/*#__PURE__*/_jsxDEV(Form.Control, {\n            id: \"mensaje\",\n            className: \"me-auto\",\n            placeholder: \"Mensaje a enviar...\",\n            onChange: e => setText(e.target.value)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 598,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(Form, {\n            children: /*#__PURE__*/_jsxDEV(Form.Check, {\n              onClick: toggleEncrypt,\n              type: \"switch\",\n              id: \"custom-switch\",\n              label: \"Cifrar mensaje\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 600,\n              columnNumber: 25\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 599,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"vr\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 606,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"a\", {\n            href: \"http://localhost:4000/08db96f7-b409-40ee-8317-307c925d302d\",\n            children: \"Video\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 607,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(Form.Control, {\n            type: \"file\",\n            onChange: e => setImg(e.target.files[0])\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 608,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(Button, {\n            variant: \"primary\",\n            onClick: handleSendMessageLocation,\n            children: \"Enviar ubicaci\\xF3n\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 609,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(Button, {\n            variant: \"danger\",\n            onClick: handleSendMessage,\n            children: \"Enviar mensaje\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 610,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 597,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 596,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 578,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 577,\n    columnNumber: 9\n  }, this);\n};\n\n_s(ChatWindow, \"E5m4SujiHIlBByGi23HsDINbtU8=\");\n\n_c = ChatWindow;\nexport default ChatWindow;\n\nvar _c;\n\n$RefreshReg$(_c, \"ChatWindow\");","map":{"version":3,"names":["Navigation","Badge","ListGroup","Card","Stack","Button","Form","Container","collection","query","where","getDocs","serverTimestamp","onSnapshot","doc","updateDoc","Timestamp","Search","db","storage","arrayUnion","arrayRemove","getDoc","getDownloadURL","ref","uploadBytesResumable","InputGroup","useContext","ChatConext","useState","useEffect","v4","uuid","AuthConext","Mensaje","MessageGroup","CryptoJS","ChatWindow","encriptar","setEncriptar","toggleEncrypt","console","log","cifrar","texto","textoCifrado","AES","encrypt","toString","data","err","setErr","idGroup","setIdGroup","messages","setMessages","messagesGroup","setMessagesGroup","chatIsGroup","setIsGroup","currentUser","unSub","chatId","exists","unSubGroup","text","setText","img","setImg","handleSendMessageLocation","navigator","geolocation","getCurrentPosition","showPosition","showError","getLocation","alert","position","str","coords","longitude","latitude","document","getElementById","value","error","handleSendMessage","storageRef","uploadTask","on","snapshot","then","downloadURL","id","senderId","uid","date","now","displayName","photoURL","user","handlerGroup","g","docRef","docSnap","handlerDefaultUser","map","m","e","target","files"],"sources":["C:/Users/User/Downloads/POI_Tims/POI-PROYECTOFINAL/POI-PROYECTOFINAL/src/Components/ChatWindow.jsx"],"sourcesContent":["//import Navigation from '../Components/NavigationLayout';\n//import Badge from 'react-bootstrap/Badge';\n//import ListGroup from 'react-bootstrap/ListGroup';\n//import Card from 'react-bootstrap/Card';\n//import Stack from 'react-bootstrap/Stack';\n//import Button from 'react-bootstrap/Button';\n//import Form from 'react-bootstrap/Form';\n//import { Container } from 'react-bootstrap';\n//import { collection, query, where, getDocs, serverTimestamp, onSnapshot, doc, updateDoc, Timestamp } from \"firebase/firestore\";\n//import Search from '../Components/Search';\n//import { db, storage } from '../firebase';\n//import { arrayUnion, arrayRemove, getDoc } from \"firebase/firestore\";\n//import { getDownloadURL, ref, uploadBytesResumable } from \"firebase/storage\";\n//\n//\n////Bootstrap\n//import InputGroup from 'react-bootstrap/InputGroup';\n//import { useContext } from 'react';\n//import { ChatConext } from '../Context/ChatContext';\n//import { useState } from 'react';\n//import { useEffect } from 'react';\n//import { v4 as uuid } from \"uuid\";\n//import { AuthConext } from '../Context/AuthContext';\n//import Mensaje from './Mensaje';\n//import MessageGroup from './MessageGroup';\n//import CryptoJS from 'crypto-js';\n//\n//const ChatWindow = () => {\n//\n//     //Manejar estado de encriptacion\n//     const [encriptar, setEncriptar] = useState(false);\n//\n//     const toggleEncrypt = () => {\n//         setEncriptar(!encriptar)\n//         console.log(encriptar)\n//     }\n// \n//     //Funciones para encriptar los mensajes\n//     const cifrar = (texto) => {\n//         console.log(\"AQUIIII\")\n//         if (encriptar) {\n//             var textoCifrado = CryptoJS.AES.encrypt(texto, \"poi\").toString();\n//             console.log(\"se encripto\")\n//             return textoCifrado;\n//         } else {\n//             console.log(\"No se encripto\")\n//             return texto;\n//         }\n//     }\n// \n//    \n//\n//    const { data } = useContext(ChatConext);\n//    const [err, setErr] = useState(false);\n//    //const [cifrado, setCifrado] = useState(false);\n//\n//    const [idGroup, setIdGroup] = useState(\"null\");\n//    const [messages, setMessages] = useState([]);\n//    const [messagesGroup, setMessagesGroup] = useState([]);\n//\n//    const [chatIsGroup, setIsGroup] = useState(false);\n//\n//    const { currentUser } = useContext(AuthConext);\n//\n//    useEffect(() => {\n//        const unSub = onSnapshot(doc(db, \"chats\", data.chatId), (doc) => {\n//            doc.exists() && setMessages(doc.data().messages)\n//        })\n//\n//\n//\n//\n//\n//        return () => {\n//\n//            unSub()\n//        }\n//\n//\n//\n//    }, [data.chatId]);\n//\n//    useEffect(() => {\n//\n//        const unSubGroup = onSnapshot(doc(db, \"chats\", idGroup), (doc) => {\n//            doc.exists() && setMessagesGroup(doc.data().messages)\n//            console.log(idGroup)\n//        })\n//\n//        return () => {\n//            unSubGroup()\n//        }\n//\n//\n//\n//    }, [idGroup]);\n//    \n//\n//\n//\n//    //DIVISION PARA EL ENVIO DE MENSAJES\n//    const [text, setText] = useState(\"\");\n//    const [img, setImg] = useState(null);\n//\n//    const handleSendMessageLocation = async () => {\n//        navigator.geolocation.getCurrentPosition(showPosition, showError);\n//        \n//        function getLocation(){\n//            if (navigator.geolocation){\n//               navigator.geolocation.getCurrentPosition(showPosition);\n//              }else{\n//                 alert(\"Geolocation is not supported by this browser.\");\n//              }\n//            }\n//           getLocation()\n//          function showPosition(position) {\n//                //var str=\"Longitude: \"+ position.coords.longitude+\"Latitude:\"+ position.coords.latitude\n//                //var str=\"Longitude: \"+ position.coords.longitude+\"Latitude:\"+ position.coords.latitude\n//                var str=\"https://www.google.com/maps/place/\" + position.coords.longitude + \",\" +- position.coords.latitude\n//\n//\n//                document.getElementById(\"mensaje\").value=str\n//            }\n//            function showError( error ) {\n//                console.log( 'getCurrentPosition returned error', error);\n//            }\n//    }\n//\n//    const handleSendMessage = async () => {\n//\n//        if (chatIsGroup) {\n//            console.log(\"es grupo\")\n//            if (img) {\n//                const storageRef = ref(storage, uuid());\n//\n//                const uploadTask = uploadBytesResumable(storageRef, img);\n//\n//                uploadTask.on(\n//                    (error) => {\n//                        //TODO:Handle Error\n//                    },\n//                    () => {\n//                        getDownloadURL(uploadTask.snapshot.ref).then(async (downloadURL) => {\n//                            await updateDoc(doc(db, \"chats\", idGroup), {\n//                                messages: arrayUnion({\n//                                    id: uuid(),\n//                                    text: cifrar(text),\n//                                    senderId: currentUser.uid,\n//                                    date: Timestamp.now(),\n//                                    img: downloadURL,\n//                                    displayName: currentUser.displayName,\n//                                    photoURL: currentUser.photoURL,\n//                                }),\n//                            });\n//                        });\n//                    }\n//                );\n//\n//            } else {\n//                await updateDoc(doc(db, \"chats\", idGroup), {\n//                    messages: arrayUnion({\n//                        id: uuid(),\n//                        text: cifrar(text),\n//                        senderId: currentUser.uid,\n//                        date: Timestamp.now(),\n//                        displayName: currentUser.displayName,\n//                        photoURL: currentUser.photoURL,\n//                    })\n//                })\n//            }\n//        } else {\n//            if (img) {\n//                const storageRef = ref(storage, uuid());\n//\n//                const uploadTask = uploadBytesResumable(storageRef, img);\n//\n//                uploadTask.on(\n//                    (error) => {\n//                        //TODO:Handle Error\n//                    },\n//                    () => {\n//                        getDownloadURL(uploadTask.snapshot.ref).then(async (downloadURL) => {\n//                            await updateDoc(doc(db, \"chats\", data.chatId), {\n//                                messages: arrayUnion({\n//                                    id: uuid(),\n//                                    text: cifrar(text),\n//                                    senderId: currentUser.uid,\n//                                    date: Timestamp.now(),\n//                                    img: downloadURL,\n//                                }),\n//                            });\n//                        });\n//                    }\n//                );\n//\n//            } else {\n//                await updateDoc(doc(db, \"chats\", data.chatId), {\n//                    messages: arrayUnion({\n//                        id: uuid(),\n//                        text: cifrar(text),\n//                        senderId: currentUser.uid,\n//                        date: Timestamp.now(),\n//                    })\n//                })\n//            }\n//\n//            await updateDoc(doc(db, \"userChats\", currentUser.uid), {\n//                [data.chatId + \".lastMessage\"]: {\n//                    text,\n//                },\n//                [data.chatId + \".date\"]: serverTimestamp(),\n//            });\n//\n//            await updateDoc(doc(db, \"userChats\", data.user.uid), {\n//                [data.chatId + \".lastMessage\"]: {\n//                    text,\n//                },\n//                [data.chatId + \".date\"]: serverTimestamp(),\n//            });\n//        }\n//\n//\n//        setIsGroup(false);\n//        setIdGroup(\"null\")\n//        setMessagesGroup([])\n//        console.log(\"ya lo puse falso\")\n//        setText(\"\");\n//        setImg(null);\n//    }\n//\n//\n//    // DIVISION PARA TRAER MSG DE UN GRUPO\n//    const handlerGroup = async (g) => {\n//\n//        try {\n//            console.log(\"chats/\" + g)\n//            const docRef = doc(db, \"chats\", g);\n//            const docSnap = await getDoc(docRef);\n//\n//            if (docSnap.exists()) {\n//                console.log(\"Document data:\", docSnap.data());\n//                setIsGroup(true);\n//                setIdGroup(g);\n//            } else {\n//                // doc.data() will be undefined in this case\n//                console.log(\"No such document!\");\n//                setIsGroup(false);\n//                setIdGroup(\"null\");\n//                setMessagesGroup([])\n//            }\n//\n//        } catch (err) {\n//\n//        }\n//    }\n//\n//    const handlerDefaultUser = () => {\n//\n//        console.log(\"yo\")\n//\n//    }\n//\n//\n//\n//    return (\n//        <div className='w-75 ms-5 h-100' >\n//            <Card className='chatContainer w-100 h-100' style={{}}>\n//                <Card.Body className='.bg-info'>\n//                    <Card.Title onClick={handlerDefaultUser} onChange={handlerGroup(data.user?.displayName)}>{data.user?.displayName}</Card.Title>\n//                </Card.Body>\n//                <ListGroup className=\"list-group-flush overflow-auto\">\n//\n//\n//                    {messages.map((m) => (\n//                        <Mensaje message={m} key={m.id} />\n//                    ))}\n//\n//                    {messagesGroup.map((m) => (\n//                        <MessageGroup message={m} key={m.id} />\n//                    ))}\n//\n//\n//\n//                </ListGroup>\n//                <Card.Body>\n//                    <Stack direction=\"horizontal\" gap={3}>\n//                        <Form.Control id=\"mensaje\" className=\"me-auto\" placeholder=\"Mensaje a enviar...\" onChange={e => setText(e.target.value)} />\n//                        <Form>\n//                        <Form.Check onClick={toggleEncrypt}\n//                            type=\"switch\"\n//                            id=\"custom-switch\"\n//                            label=\"Cifrar mensaje\"\n//                        />\n//                        </Form>\n//                        <div className=\"vr\" />\n//                        <a href=\"http://localhost:4000/08db96f7-b409-40ee-8317-307c925d302d\">Video</a>\n//                        <Form.Control type=\"file\" onChange={e => setImg(e.target.files[0])} />\n//                        <Button variant=\"primary\" onClick={handleSendMessageLocation}>Enviar ubicación</Button>\n//                        <Button variant=\"danger\" onClick={handleSendMessage}>Enviar mensaje</Button>\n//\n//                    </Stack>\n//                </Card.Body>\n//            </Card>\n//        </div>\n//\n//    )\n//\n//}\n//\n//export default ChatWindow\n\nimport Navigation from '../Components/NavigationLayout';\nimport Badge from 'react-bootstrap/Badge';\nimport ListGroup from 'react-bootstrap/ListGroup';\nimport Card from 'react-bootstrap/Card';\nimport Stack from 'react-bootstrap/Stack';\nimport Button from 'react-bootstrap/Button';\nimport Form from 'react-bootstrap/Form';\nimport { Container } from 'react-bootstrap';\nimport { collection, query, where, getDocs, serverTimestamp, onSnapshot, doc, updateDoc, Timestamp } from \"firebase/firestore\";\nimport Search from '../Components/Search';\nimport { db, storage } from '../firebase';\nimport { arrayUnion, arrayRemove, getDoc } from \"firebase/firestore\";\nimport { getDownloadURL, ref, uploadBytesResumable } from \"firebase/storage\";\n\n\n//Bootstrap\nimport InputGroup from 'react-bootstrap/InputGroup';\nimport { useContext } from 'react';\nimport { ChatConext } from '../Context/ChatContext';\nimport { useState } from 'react';\nimport { useEffect } from 'react';\nimport { v4 as uuid } from \"uuid\";\nimport { AuthConext } from '../Context/AuthContext';\nimport Mensaje from './Mensaje';\nimport MessageGroup from './MessageGroup';\nimport CryptoJS from 'crypto-js';\n\nconst ChatWindow = () => {\n\n    //Manejar estado de encriptacion\n    const [encriptar, setEncriptar] = useState(false);\n\n    const toggleEncrypt = () => {\n        setEncriptar(!encriptar)\n        console.log(encriptar)\n    }\n \n    //Funciones para encriptar los mensajes\n    const cifrar = (texto) => {\n        console.log(\"AQUIIII\")\n        if (encriptar) {\n            var textoCifrado = CryptoJS.AES.encrypt(texto, \"poi\").toString();\n            console.log(\"se encripto\")\n            return textoCifrado;\n        } else {\n            console.log(\"No se encripto\")\n            return texto;\n        }\n    }\n \n    \n\n    const { data } = useContext(ChatConext);\n    const [err, setErr] = useState(false);\n    //const [cifrado, setCifrado] = useState(false);\n\n    const [idGroup, setIdGroup] = useState(\"null\");\n    const [messages, setMessages] = useState([]);\n    const [messagesGroup, setMessagesGroup] = useState([]);\n\n    const [chatIsGroup, setIsGroup] = useState(false);\n\n    const { currentUser } = useContext(AuthConext);\n\n    useEffect(() => {\n        const unSub = onSnapshot(doc(db, \"chats\", data.chatId), (doc) => {\n            doc.exists() && setMessages(doc.data().messages)\n        })\n\n\n\n\n\n        return () => {\n\n            unSub()\n        }\n\n\n\n    }, [data.chatId]);\n\n    useEffect(() => {\n\n        const unSubGroup = onSnapshot(doc(db, \"chats\", idGroup), (doc) => {\n            doc.exists() && setMessagesGroup(doc.data().messages)\n            console.log(idGroup)\n        })\n\n        return () => {\n            unSubGroup()\n        }\n\n\n\n    }, [idGroup]);\n    \n\n\n\n    //DIVISION PARA EL ENVIO DE MENSAJES\n    const [text, setText] = useState(\"\");\n    const [img, setImg] = useState(null);\n\n    const handleSendMessageLocation = async () => {\n        navigator.geolocation.getCurrentPosition(showPosition, showError);\n        \n        function getLocation(){\n            if (navigator.geolocation){\n               navigator.geolocation.getCurrentPosition(showPosition);\n              }else{\n                 alert(\"Geolocation is not supported by this browser.\");\n              }\n            }\n           getLocation()\n          function showPosition(position) {\n                //var str=\"Longitude: \"+ position.coords.longitude+\"Latitude:\"+ position.coords.latitude\n                //var str=\"Longitude: \"+ position.coords.longitude+\"Latitude:\"+ position.coords.latitude\n                var str=\"https://www.google.com/maps/place/\" + position.coords.longitude + \",\" +- position.coords.latitude\n\n\n                document.getElementById(\"mensaje\").value=str\n            }\n            function showError( error ) {\n                console.log( 'getCurrentPosition returned error', error);\n            }\n    }\n\n    const handleSendMessage = async () => {\n\n        if (chatIsGroup) {\n            console.log(\"es grupo\")\n            if (img) {\n                const storageRef = ref(storage, uuid());\n\n                const uploadTask = uploadBytesResumable(storageRef, img);\n\n                uploadTask.on(\n                    (error) => {\n                        //TODO:Handle Error\n                    },\n                    () => {\n                        getDownloadURL(uploadTask.snapshot.ref).then(async (downloadURL) => {\n                            await updateDoc(doc(db, \"chats\", idGroup), {\n                                messages: arrayUnion({\n                                    id: uuid(),\n                                    text: cifrar(text),\n                                    senderId: currentUser.uid,\n                                    date: Timestamp.now(),\n                                    img: downloadURL,\n                                    displayName: currentUser.displayName,\n                                    photoURL: currentUser.photoURL,\n                                }),\n                            });\n                        });\n                    }\n                );\n\n            } else {\n                await updateDoc(doc(db, \"chats\", idGroup), {\n                    messages: arrayUnion({\n                        id: uuid(),\n                        text: cifrar(text),\n                        senderId: currentUser.uid,\n                        date: Timestamp.now(),\n                        displayName: currentUser.displayName,\n                        photoURL: currentUser.photoURL,\n                    })\n                })\n            }\n        } else {\n            if (img) {\n                const storageRef = ref(storage, uuid());\n\n                const uploadTask = uploadBytesResumable(storageRef, img);\n\n                uploadTask.on(\n                    (error) => {\n                        //TODO:Handle Error\n                    },\n                    () => {\n                        getDownloadURL(uploadTask.snapshot.ref).then(async (downloadURL) => {\n                            await updateDoc(doc(db, \"chats\", data.chatId), {\n                                messages: arrayUnion({\n                                    id: uuid(),\n                                    text: cifrar(text),\n                                    senderId: currentUser.uid,\n                                    date: Timestamp.now(),\n                                    img: downloadURL,\n                                }),\n                            });\n                        });\n                    }\n                );\n\n            } else {\n                await updateDoc(doc(db, \"chats\", data.chatId), {\n                    messages: arrayUnion({\n                        id: uuid(),\n                        text: cifrar(text),\n                        senderId: currentUser.uid,\n                        date: Timestamp.now(),\n                    })\n                })\n            }\n\n            await updateDoc(doc(db, \"userChats\", currentUser.uid), {\n                [data.chatId + \".lastMessage\"]: {\n                    text,\n                },\n                [data.chatId + \".date\"]: serverTimestamp(),\n            });\n\n            await updateDoc(doc(db, \"userChats\", data.user.uid), {\n                [data.chatId + \".lastMessage\"]: {\n                    text,\n                },\n                [data.chatId + \".date\"]: serverTimestamp(),\n            });\n        }\n\n\n        setIsGroup(false);\n        setIdGroup(\"null\")\n        setMessagesGroup([])\n        console.log(\"ya lo puse falso\")\n        setText(\"\");\n        setImg(null);\n    }\n\n\n    // DIVISION PARA TRAER MSG DE UN GRUPO\n    const handlerGroup = async (g) => {\n\n        try {\n            console.log(\"chats/\" + g)\n            const docRef = doc(db, \"chats\", g);\n            const docSnap = await getDoc(docRef);\n\n            if (docSnap.exists()) {\n                console.log(\"Document data:\", docSnap.data());\n                setIsGroup(true);\n                setIdGroup(g);\n            } else {\n                // doc.data() will be undefined in this case\n                //console.log(\"No such document!\");\n                setIsGroup(false);\n                setIdGroup(\"null\");\n                setMessagesGroup([])\n            }\n\n        } catch (err) {\n\n        }\n    }\n\n    const handlerDefaultUser = () => {\n\n        console.log(\"yo\")\n\n    }\n\n\n\n    return (\n        <div className='w-75 ms-5 h-100' >\n            <Card className='chatContainer w-100 h-100' style={{}}>\n                <Card.Body className='.bg-info'>\n                    <Card.Title >{data.user?.displayName}</Card.Title>\n                </Card.Body>\n                <ListGroup className=\"list-group-flush overflow-auto\" onClick={handlerDefaultUser} onChange={handlerGroup(data.user?.displayName)}>\n\n\n                    {messages.map((m)  => (\n                        <Mensaje  message={m} key={m.id} />\n                    ))}\n\n                    {messagesGroup.map((m) => (\n                        <MessageGroup message={m} key={m.id} />\n                    ))}\n\n\n\n                </ListGroup>\n                <Card.Body>\n                    <Stack direction=\"horizontal\" gap={3}>\n                        <Form.Control id=\"mensaje\" className=\"me-auto\" placeholder=\"Mensaje a enviar...\" onChange={e => setText(e.target.value)} />\n                        <Form>\n                        <Form.Check onClick={toggleEncrypt}\n                            type=\"switch\"\n                            id=\"custom-switch\"\n                            label=\"Cifrar mensaje\"\n                        />\n                        </Form>\n                        <div className=\"vr\" />\n                        <a href=\"http://localhost:4000/08db96f7-b409-40ee-8317-307c925d302d\">Video</a>\n                        <Form.Control type=\"file\" onChange={e => setImg(e.target.files[0])} />\n                        <Button variant=\"primary\" onClick={handleSendMessageLocation}>Enviar ubicación</Button>\n                        <Button variant=\"danger\" onClick={handleSendMessage}>Enviar mensaje</Button>\n\n                    </Stack>\n                </Card.Body>\n            </Card>\n        </div>\n\n    )\n\n}\n\nexport default ChatWindow"],"mappings":";;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA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"},"metadata":{},"sourceType":"module"}